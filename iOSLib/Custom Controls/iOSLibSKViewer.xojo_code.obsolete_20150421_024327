#tag Class
Protected Class iOSLibSKViewer
Inherits iOSUserControl
Implements iOSLibEventReceiver
	#tag Event
		Sub Close()
		  if mscene <> nil then
		    mscene.RemoveObserver (self)
		    if mScene.View <> nil then
		      mscene.RemoveFromParent
		    end if
		    mScene = nil
		  end if
		  // if mscene < nil then mScene.RemoveObserver(self)
		End Sub
	#tag EndEvent

	#tag Event
		Function CreateView() As UInteger
		  dim frame as new Rect (0,0,100,100)
		  mSKView = new iOSLibSKViewWithInterface (frame.tonsrect)
		  mSKView.registerobserver (self)
		  mSKView.AutoRelease
		  Return UInteger ( mSKView.Id)
		End Function
	#tag EndEvent


	#tag Method, Flags = &h0
		Attributes( hidden )  Sub informonDidApplyConstraints()
		  RaiseEvent DidApplyConstraints
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Attributes( hidden )  Sub informonDidBeginContact(Contact as Ptr)
		  RaiseEvent DidBeginContact (new iOSLibSKPhysicsContact(contact))
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Attributes( hidden )  Sub informonDidChangeSize(OldSize as NSSize)
		  RaiseEvent DidChangeSize (oldsize)
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Attributes( hidden )  Sub informonDidEndContact(Contact as Ptr)
		  RaiseEvent DidEndContact( new iOSLibSKPhysicsContact (contact))
		  
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Attributes( hidden )  Sub informonDidEvaluteActions()
		  RaiseEvent DidEvaluateActions
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Attributes( hidden )  Sub informonDidFinishUpdate()
		  RaiseEvent DidFinishUpdate
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Attributes( hidden )  Sub informondidMoveToView(view as Ptr)
		  RaiseEvent DidMoveToView (ioslibskview.makefromptr( view))
		  
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Attributes( hidden )  Sub informonDidSimulatePhysics()
		  RaiseEvent DidSimulatePhysics
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Attributes( hidden )  Sub InformOnSceneUpdate(CurrentTime as double)
		  RaiseEvent UpdateForScene (currenttime)
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Attributes( hidden )  Sub informonwillMoveFromView(view as Ptr)
		  RaiseEvent WillMoveFromView (ioslibskview.makefromptr( view))
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub PresentScene(newScene as iOSLibSKSceneWithInterface)
		  if mscene <> nil then
		    mscene.RemoveObserver (self)
		    if mScene.View <> nil then
		      mscene.RemoveFromParent
		    end if
		  end if
		  mScene = newScene
		  mScene.RegisterObserver (self)
		  mSKView.PresentScene (mScene)
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub ReceivedEvent(Details as iOSLibArray)
		  // Part of the iOSLibEventReceiver interface.
		  Select case  Details.TextAtIndex(0)
		  case iOSLibSKViewWithInterface.WillMoveToSuperview
		    dim newview as ioslibview
		    if Details.Count > 1 then newview  = iOSLibView.MakeFromPtr (Details.PtrAtIndex(1))
		    RaiseEvent WillMoveToSuperview (newview)
		  case iOSLibSKViewWithInterface.WillMoveToWindow
		    dim windowptr as ptr
		    if Details.Count > 1 then WindowPtr = Details.PtrAtIndex(1)
		    RaiseEvent WillMoveToWindow (windowptr)
		  case iOSLibSKViewWithInterface.DidAddSubview
		    dim newview as ioslibview  = iOSLibView.MakeFromPtr (Details.PtrAtIndex(1))
		    RaiseEvent DidAddSubview (newview)
		  case iOSLibSKViewWithInterface.DidMoveToSuperview
		    RaiseEvent DidMoveToSuperview
		  case iOSLibSKViewWithInterface.DidMoveToWindow
		    RaiseEvent DidMoveToWindow
		  case iOSLibSKViewWithInterface.WillRemoveSubview
		    dim newview as ioslibview  = iOSLibView.MakeFromPtr (Details.PtrAtIndex(1))
		    RaiseEvent WillRemoveSubview (newview)
		  case ioslibskscenewithinterface.DidApplyConstraints
		    RaiseEvent DidApplyConstraints
		  End Select
		  
		End Sub
	#tag EndMethod


	#tag Hook, Flags = &h0
		Event DidAddSubview(view as iOSLibView)
	#tag EndHook

	#tag Hook, Flags = &h0
		Event DidApplyConstraints()
	#tag EndHook

	#tag Hook, Flags = &h0
		Event DidBeginContact(Contact as iOSLibSKPhysicsContact)
	#tag EndHook

	#tag Hook, Flags = &h0
		Event DidChangeSize(OldSize as NSSize)
	#tag EndHook

	#tag Hook, Flags = &h0
		Event DidEndContact(Contact as iOSLibSKPhysicsContact)
	#tag EndHook

	#tag Hook, Flags = &h0
		Event DidEvaluateActions()
	#tag EndHook

	#tag Hook, Flags = &h0
		Event DidFinishUpdate()
	#tag EndHook

	#tag Hook, Flags = &h0
		Event DidMoveToSuperview()
	#tag EndHook

	#tag Hook, Flags = &h0
		Event DidMoveToView(View as iOSLibSKView)
	#tag EndHook

	#tag Hook, Flags = &h0
		Event DidMoveToWindow()
	#tag EndHook

	#tag Hook, Flags = &h0
		Event DidSimulatePhysics()
	#tag EndHook

	#tag Hook, Flags = &h0
		Event UpdateForScene(time as Double)
	#tag EndHook

	#tag Hook, Flags = &h0
		Event WillMoveFromView(fromView as iOSLibSKView)
	#tag EndHook

	#tag Hook, Flags = &h0
		Event WillMoveToSuperview(view as iOSLibView)
	#tag EndHook

	#tag Hook, Flags = &h0
		Event WillMoveToWindow(window as ptr)
	#tag EndHook

	#tag Hook, Flags = &h0
		Event WillRemoveSubview(view as iOSLibView)
	#tag EndHook


	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  Return view.allowsTransparency
			End Get
		#tag EndGetter
		#tag Setter
			Set
			  view.allowsTransparency = value
			End Set
		#tag EndSetter
		AllowsTransparency As Boolean
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  return view.asynchronous
			End Get
		#tag EndGetter
		#tag Setter
			Set
			  view.Asynchronous = value
			End Set
		#tag EndSetter
		Asynchronous As Boolean
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  Return view.frameInterval
			End Get
		#tag EndGetter
		#tag Setter
			Set
			  view.FrameInterval = value
			End Set
		#tag EndSetter
		FrameInterval As Integer
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  return mSKView.Id
			End Get
		#tag EndGetter
		id As Ptr
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  Return view.ignoresSiblingOrder 
			End Get
		#tag EndGetter
		#tag Setter
			Set
			  view.ignoresSiblingOrder = value
			End Set
		#tag EndSetter
		IgnoresSiblingOrder As Boolean
	#tag EndComputedProperty

	#tag Property, Flags = &h21
		Private mScene As iOSLibSKSceneWithInterface
	#tag EndProperty

	#tag Property, Flags = &h21
		Private mSKView As iOSLibSKViewWithInterface
	#tag EndProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  return view.Paused
			End Get
		#tag EndGetter
		#tag Setter
			Set
			  view.Paused = value
			End Set
		#tag EndSetter
		Paused As Boolean
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  return view.shouldCullNonVisibleNodes 
			End Get
		#tag EndGetter
		#tag Setter
			Set
			  view.shouldCullNonVisibleNodes = value
			End Set
		#tag EndSetter
		ShouldCullNonVisibleNodes As Boolean
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  return view.ShowsDrawCount
			End Get
		#tag EndGetter
		#tag Setter
			Set
			  view.ShowsDrawCount = value
			End Set
		#tag EndSetter
		ShowsDrawCount As Boolean
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  return view.ShowsFields
			End Get
		#tag EndGetter
		#tag Setter
			Set
			  view.ShowsFields = value
			End Set
		#tag EndSetter
		ShowsFields As Boolean
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  return view.ShowsFPS
			End Get
		#tag EndGetter
		#tag Setter
			Set
			  view.ShowsFPS = value
			End Set
		#tag EndSetter
		ShowsFPS As Boolean
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  Return view.showsNodeCount
			End Get
		#tag EndGetter
		#tag Setter
			Set
			   view.showsNodeCount = value
			End Set
		#tag EndSetter
		ShowsNodeCount As Boolean
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  Return view.showsPhysics
			End Get
		#tag EndGetter
		#tag Setter
			Set
			   view.ShowsPhysics = value
			End Set
		#tag EndSetter
		ShowsPhysics As Boolean
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  Return view.showsQuadCount 
			End Get
		#tag EndGetter
		#tag Setter
			Set
			  view.showsQuadCount = value
			End Set
		#tag EndSetter
		ShowsQuadCount As Boolean
	#tag EndComputedProperty

	#tag ComputedProperty, Flags = &h0
		#tag Getter
			Get
			  // dim ego as new iOSLibView (mid)
			  // dim layer as iOSLibCALayer = ego.Layer
			  // return  new iOSLibCAGradientLayer(layer.SubLayers.PtrAtIndex(0))
			  return mSKView
			End Get
		#tag EndGetter
		View As iOSLibSKViewWithInterface
	#tag EndComputedProperty


	#tag ViewBehavior
		#tag ViewProperty
			Name="AccessibilityHint"
			Group="Behavior"
			Type="Text"
		#tag EndViewProperty
		#tag ViewProperty
			Name="AccessibilityLabel"
			Group="Behavior"
			Type="Text"
		#tag EndViewProperty
		#tag ViewProperty
			Name="AllowsTransparency"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="Asynchronous"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="FrameInterval"
			Group="Behavior"
			Type="Integer"
		#tag EndViewProperty
		#tag ViewProperty
			Name="Height"
			Visible=true
			Group="Position"
			Type="Double"
		#tag EndViewProperty
		#tag ViewProperty
			Name="IgnoresSiblingOrder"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="Index"
			Visible=true
			Group="ID"
			InitialValue="-2147483648"
			Type="Integer"
		#tag EndViewProperty
		#tag ViewProperty
			Name="Left"
			Visible=true
			Group="Position"
			InitialValue="0"
			Type="Integer"
		#tag EndViewProperty
		#tag ViewProperty
			Name="Name"
			Visible=true
			Group="ID"
			Type="String"
		#tag EndViewProperty
		#tag ViewProperty
			Name="Paused"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="ShouldCullNonVisibleNodes"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="ShowsDrawCount"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="ShowsFields"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="ShowsFPS"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="ShowsNodeCount"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="ShowsPhysics"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="ShowsQuadCount"
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="Super"
			Visible=true
			Group="ID"
			Type="String"
		#tag EndViewProperty
		#tag ViewProperty
			Name="Top"
			Visible=true
			Group="Position"
			InitialValue="0"
			Type="Integer"
		#tag EndViewProperty
		#tag ViewProperty
			Name="Visible"
			Visible=true
			Group="Behavior"
			Type="Boolean"
		#tag EndViewProperty
		#tag ViewProperty
			Name="Width"
			Visible=true
			Group="Position"
			Type="Double"
		#tag EndViewProperty
	#tag EndViewBehavior
End Class
#tag EndClass
